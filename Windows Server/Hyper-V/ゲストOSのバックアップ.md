# ゲストOSのバックアップ

## Hyper-Vマネージャーでエクスポート・インポート
### エクスポート

- 管理用PCにてHyper-Vマネージャーを起動する。
- ゲストOSにログインしてOSをシャットダウンする。
- Hyper-Vマネージャーの仮想マシン一覧から対象のゲストOSを選び、右クリックしてエクスポートを選ぶ。
- ファイルの保存先を聞かれるので、（Hyper-Vサーバ上の）適切なフォルダ名を指定する。このフォルダの中に、バックアップファイルを格納したフォルダが作られる。
  - 今回はC:\Backupを指定し、ゲストOS名がwin7-pcだったので、C:\Backup\win-7-pcというフォルダにバックアップが作られた。
- 環境によると思われるが、エクスポートは数分から数十分程度は掛かる。Hyper-Vマネージャーの「状況」に「エクスポート中（25%）」のように進捗が表示されるので、参考にする。

### インポート

- 管理用PCにてHyper-Vマネージャーを起動する。
- 右ペインの操作から仮想マシンのインポートを選ぶ。
- 「フォルダーの検索」の「インポートする仮想マシンを含むフォルダー」でエクスポートしたフォルダーを指定して、次へ。
  - 今回はC:￥Backup\win7-pcを指定した。
- 「仮想マシンの選択」の「インポートする仮想マシンを選択する」で、インポートした仮想マシンのマシン名を選び、次へ。
  - 今回はwin7-pcを選択した。
- 「インポートの種類の選択」の「実行するインポートの種類を選択する」で、目的の項目を選び、次へ。
  - 今回は「仮想マシンをコピーする（新しい一意なIDを作成する）」を選択した。
- 「移動先の選択」で、今回は以下のように指定して、次へ。
  - 仮想マシンを別の場所に格納する チェックする
  - 仮想マシンの構成フォルダー D:\Hyper-V\win7-pc
  - チェックポイントストア D:\Hyper-V\win7-pc
  - スマートページングフォルダー D:\Hyper-V\win7-pc
- 「保存するフォルダーを選択します」の「インポートした仮想ハードディスクのこの仮想マシンでの保存場所を指定してください」で、今回は以下のように指定して、次へ。
  - D:\Hyper-V\win7-pc
- 「ネットワークへの接続」で仮想マシン内で使用するスイッチを選ぶが、今回はとりあえず動作確認をするためだけに起動したいので、「未接続」を選ぶ。次へ。
- 要約を確認して、完了を押下する。
  - なお、今回の指定でインポート完了すると、以下のような構成でファイルが作られる。
  - D:\Hyper-V\win7-pc\Virtual Machines\ABC123-XYZ789-XXX000
  - D:\Hyper-V\win7-pc\Virtual Machines\ABC123-XYZ789-XXX000.xml
  - D:\Hyper-V\win7-pc\win7-pc.vhdx
  - ABC123-XYZ789-XXX000は仮想マシンID


### 参考
http://www.atmarkit.co.jp/fwin2k/win2ktips/1301hvexp2/hvexp2.html

## 参考

- http://jp.fujitsu.com/platform/server/primergy/technical/construct/pdf/win2008r2-hyperv-backup.pdf
