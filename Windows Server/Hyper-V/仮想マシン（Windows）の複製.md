# 仮想マシン（Windows）の複製


- 複製元のWindowsを起動し、sysprep.exe（%WINDIR%\System32\sysprep以下）を実行する。
  - 「システムクリーンアップアクション」で「システムのOOBEに入る」を選び、「一般化する」にチェックを入れる。
  - 「シャットダウンオプション」で「シャットダウン」を選ぶ。
  - OKを押すと、Sysprep実行後にWindowsがシャットダウンする。
- Hyper-Vマネージャーを起動して、複製元の仮想マシンを選んで右クリックして「エクスポート」を選ぶ。
- 適当な保存先フォルダに選んで、「エクスポート」を実行する。エクスポートにはしばらく時間がかかるので、Hyper-Vマネージャーで仮想マシンの状態を監視しておく。
- エクスポートが終わったら、保存先フォルダを開き、仮想マシン名フォルダ以下の3つのファイルをリネーム・編集する。
  - config.xml : メモ帳等で開き、複製元の仮想マシン名を複製先の新しい仮想マシン名に置換する。
  - 仮想マシンID.exp  : 同上
  - 仮想マシン名.vhd : 複製先の新しい仮想マシン名にリネームする。
- Hyper-VマネージャーでHyper-Vサーバを選び右クリックしてメニューからインポートを選び、
  - 「場所」を保存先フォルダの仮想マシン名フォルダにして、
  - 「インポートの設定」を「仮想マシンをコピーする（新しい一意なIDを作成する）」にして、
  - 「すべてのファイルを複製し・・・」にチェックを入れる。
  - インポートを実行する。
- インポートが終了したら、Hyper-Vマネージャーから複製先の新しい仮想マシンを選び、起動し、Windowsの設定（プロダクトキーの入力等）を行う。

## 参考

- SIDの重複について http://technet.microsoft.com/ja-jp/windows/ff363109.aspx
